# Bed Presence Engine Package - Phase 1
# Simple z-score based presence detection

binary_sensor:
  - platform: bed_presence_engine
    name: "Bed Occupied"
    id: bed_occupied
    energy_sensor: ld2410_still_energy  # Using still/static energy per LD2410 naming
    k_on: 4.0   # Turn ON when z-score > 4.0 (4 std deviations)
    k_off: 2.0  # Turn OFF when z-score < 2.0 (2 std deviations)
    state_reason:
      name: "Presence State Reason"
      id: presence_state_reason

# Number inputs to allow threshold multiplier tuning from Home Assistant
# Phase 1 spec: Persistent across reboots (restore_value: true)
number:
  - platform: template
    name: "k_on (ON Threshold Multiplier)"
    id: k_on_input
    min_value: 0.0
    max_value: 10.0
    step: 0.1
    initial_value: 4.0
    optimistic: true
    restore_value: true  # Phase 1 requirement
    mode: slider
    on_value:
      then:
        - lambda: |-
            auto engine = id(bed_occupied);
            engine->update_k_on(x);

  - platform: template
    name: "k_off (OFF Threshold Multiplier)"
    id: k_off_input
    min_value: 0.0
    max_value: 10.0
    step: 0.1
    initial_value: 2.0
    optimistic: true
    restore_value: true  # Phase 1 requirement
    mode: slider
    on_value:
      then:
        - lambda: |-
            auto engine = id(bed_occupied);
            engine->update_k_off(x);
